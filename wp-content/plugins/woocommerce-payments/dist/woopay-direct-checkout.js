(()=>{var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var s=o.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p=window.wcpayAssets.url,(()=>{"use strict";const t=window.wp.element,o=e=>{let t=null;if("undefined"!=typeof wcpayConfig)t=wcpayConfig;else if("undefined"!=typeof wcpay_upe_config)t=wcpay_upe_config;else{if("undefined"==typeof wc)return null;t=wc.wcSettings.getSetting("woocommerce_payments_data")}return t[e]||null},s=window.ReactDOM;var n=e.n(s);const a=window.React,i=e=>{let{listeners:s,actionCallback:n}=e;const i=(0,a.useRef)();return(0,a.useEffect)((()=>{if(!i.current)return;const e=i.current;e.addEventListener("load",(()=>{s.setIframePostMessage((t=>{e.contentWindow.postMessage(t,o("woopayHost"))}))}));const t=e=>{if(o("woopayHost").startsWith(e.origin)&&e.data.action in n){const t=n[e.data.action];s[t](e.data.value)}};return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[n,s]),(0,t.createElement)("iframe",{ref:i,src:(()=>{const e=JSON.stringify(o("tracksUserIdentity")),t=new URLSearchParams;return t.append("testMode",o("testMode")),t.append("source_url",window.location.href),t.append("tracksUserIdentity",e),o("woopayHost")+"/connect/?"+t.toString()})(),style:{height:0},title:"WooPay Connect Direct Checkout"})};function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;for(const s in e){const n=e[s],a=t?t+"["+s+"]":s;"string"==typeof n||"number"==typeof n?o.append(a,n):"object"==typeof n&&r(n,a,o)}return o}async function c(e,t,o){const s=r(t,"",new FormData),n=await fetch(e,{method:"POST",body:s,...o});return await n.json()}const d=class{static state={iframePostMessage:null};static listeners={setIframePostMessage:()=>{},setTempThirdPartyCookie:()=>{},setIsWooPayThirdPartyCookiesEnabled:()=>{},setIsUserLoggedIn:()=>{},setWoopaySessionResponse:()=>{}};static actionCallback={set_temp_third_party_cookie_success:"setTempThirdPartyCookie",get_is_third_party_cookies_enabled_success:"setIsWooPayThirdPartyCookiesEnabled",get_is_user_logged_in_success:"setIsUserLoggedIn",set_redirect_session_data_success:"setWoopaySessionResponse"};static init(){this.state.iframePostMessage=new Promise((e=>{this.listeners.setIframePostMessage=e})),this.injectWooPayConnectIframe()}static isWooPayEnabled(){return o("isWooPayEnabled")}static injectWooPayConnectIframe(){const e=e=>{e.parentElement.style.position="relative";const o=document.createElement("div");o.style.visibility="hidden",o.style.position="absolute",o.style.height="0",e.parentElement.appendChild(o),n().render((0,t.createElement)(i,{listeners:this.listeners,actionCallback:this.actionCallback}),o)},o=document.querySelector(".wc-proceed-to-checkout .checkout-button"),s=document.querySelector(".wp-block-woocommerce-proceed-to-checkout-block");o?e(o):s&&e(s)}static async setTempThirdPartyCookie(){const e=new Promise((e=>{this.listeners.setTempThirdPartyCookie=e}));return(await this.state.iframePostMessage)({action:"setTempThirdPartyCookie"}),this.state.iframePostMessage=new Promise((e=>{this.listeners.setIframePostMessage=e})),await e}static async isWooPayThirdPartyCookiesEnabled(){if(!await this.setTempThirdPartyCookie())return!1;const e=new Promise((e=>{this.listeners.setIsWooPayThirdPartyCookiesEnabled=e}));return(await this.state.iframePostMessage)({action:"getIsThirdPartyCookiesEnabled"}),await e}static async isUserLoggedIn(){const e=new Promise((e=>{this.listeners.setIsUserLoggedIn=e}));return(await this.state.iframePostMessage)({action:"getIsUserLoggedIn"}),await e}static async sendSessionDataToWooPay(){const e=new Promise((e=>{this.listeners.setWoopaySessionResponse=e})),t=await this.getWooPaySessionFromMerchant();(await this.state.iframePostMessage)({action:"setRedirectSessionData",value:t});const{redirect_url:o}=await e;return o}static getCheckoutRedirectElements(){const e=[],t=t=>{const o=document.querySelector(t);o&&e.push(o)};return t(".wc-proceed-to-checkout .checkout-button"),t(".wp-block-woocommerce-proceed-to-checkout-block"),e}static redirectToWooPaySession(e){e.forEach((e=>{e.addEventListener("click",(async e=>{e.preventDefault();const t=await this.sendSessionDataToWooPay();window.location.href=t}))}))}static redirectToWooPay(e){e.forEach((e=>{e.addEventListener("click",(async e=>{e.preventDefault();const t=await this.sendSessionDataToWooPay();window.location.href=t+"&woopay_checkout_redirect=1"}))}))}static async getWooPaySessionFromMerchant(){return c(function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"wcpay_";return e.toString().replace("%%endpoint%%",o+t)}(o("wcAjaxUrl"),"get_woopay_session"),{_ajax_nonce:o("woopaySessionNonce")})}};window.addEventListener("load",(async()=>{if(!d.isWooPayEnabled())return;d.init();const e=d.getCheckoutRedirectElements();await d.isWooPayThirdPartyCookiesEnabled()?await d.isUserLoggedIn()&&d.redirectToWooPaySession(e):d.redirectToWooPay(e)}))})()})();